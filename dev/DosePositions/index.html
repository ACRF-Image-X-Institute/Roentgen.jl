<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Dose Positions · Roentgen.jl Documentation</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Roentgen.jl Documentation</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Roentgen.jl</a></li><li><span class="tocitem">Dose Volume</span><ul><li><a class="tocitem" href="../DoseVolume/">Dose Volumes</a></li><li class="is-active"><a class="tocitem" href>Dose Positions</a><ul class="internal"><li><a class="tocitem" href="#Dose-Grids"><span>Dose Grids</span></a></li></ul></li><li><a class="tocitem" href="../ExternalSurfaces/">External Surfaces</a></li></ul></li><li><span class="tocitem">Computing Dose</span><ul><li><a class="tocitem" href="../DoseReconstruction/">Dose Reconstruction from a Treatment Plan</a></li><li><a class="tocitem" href="../Fluence/">Generating Fluence Maps</a></li><li><a class="tocitem" href="../DoseFluenceMatrix/">Dose-Fluence Matrix</a></li><li><a class="tocitem" href="../DoseCalculationAlgorithms/">Dose Calculation Algorithms</a></li></ul></li><li><span class="tocitem">Utilties</span><ul><li><a class="tocitem" href="../Structures/">Structures</a></li><li><a class="tocitem" href="../TreatmentPlan/">Treatment Plan</a></li></ul></li><li><a class="tocitem" href="../API/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Dose Volume</a></li><li class="is-active"><a href>Dose Positions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Dose Positions</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/Image-X-Institute/Roentgen.jl/blob/main/docs/src/DosePositions.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Dose-Positions"><a class="docs-heading-anchor" href="#Dose-Positions">Dose Positions</a><a id="Dose-Positions-1"></a><a class="docs-heading-anchor-permalink" href="#Dose-Positions" title="Permalink"></a></h1><p>Dose positions are positions in the patient volume where dose is computed. While this could span the whole patient volume, for some applications a smaller dose volume is preferred which target various regions or structures in the body.</p><p>A number of dose position types are provided. There are generally two ways of creating dose positions: through the default constructor, or using a bounding object.</p><h2 id="Dose-Grids"><a class="docs-heading-anchor" href="#Dose-Grids">Dose Grids</a><a id="Dose-Grids-1"></a><a class="docs-heading-anchor-permalink" href="#Dose-Grids" title="Permalink"></a></h2><p>Dose grids are a subtype of dose positions where each position is located on a Cartesian grid. Each axis need not be uniform, they can take any vector of positions.  These are useful as they reduce memory usage, and allow for easy export to visualisation software.</p><p><a href="../API/#Roentgen.DoseGrid"><code>DoseGrid</code></a> is a simple Cartesian grid where dose is computed on every point in the box.</p><p>They are constructed by supplying grid axes:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; axes = (-10.:5.:10, -10.:5.:10, -10.:5.:10)</code><code class="nohighlight hljs ansi" style="display:block;">(-10.0:5.0:10.0, -10.0:5.0:10.0, -10.0:5.0:10.0)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; pos = DoseGrid(axes);</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>When using a bounding object, the dose grid dimensions are set to encompass the whole bounding object. For example, a dose grid bounded by a cylinder will produce the following:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; pos = DoseGrid(5., CylinderBounds(10., 10.));</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; getaxes(pos)</code><code class="nohighlight hljs ansi" style="display:block;">(-5.0:5.0:5.0, -5.0:5.0:5.0, -5.0:5.0:5.0)</code></pre><p>It supports both linear and Cartesian indexing:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; pos[1]</code><code class="nohighlight hljs ansi" style="display:block;">3-element StaticArraysCore.SVector{3, Float64} with indices SOneTo(3):
 -5.0
 -5.0
 -5.0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; pos[1, 2, 3]</code><code class="nohighlight hljs ansi" style="display:block;">3-element StaticArraysCore.SVector{3, Float64} with indices SOneTo(3):
 -5.0
  0.0
  5.0</code></pre><h3 id="Masked-Dose-Grid"><a class="docs-heading-anchor" href="#Masked-Dose-Grid">Masked Dose Grid</a><a id="Masked-Dose-Grid-1"></a><a class="docs-heading-anchor-permalink" href="#Masked-Dose-Grid" title="Permalink"></a></h3><p>Masked dose grids are Cartesian grids where points can be masked such that they are not used when iterating through the grid. This is an efficient implementation of sparse-like grids which maintain their 3D grid structure while avoiding computations on unnecessary positions.</p><p>Masked dose grids (<a href="../API/#Roentgen.DoseGridMasked"><code>DoseGridMasked</code></a>) can be constructed by suppling grid axes and a vector of <code>CartesianIndex</code> where the points are enabled:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; indices = [CartesianIndex(1, 1, 1), CartesianIndex(2, 4, 1)]</code><code class="nohighlight hljs ansi" style="display:block;">2-element Vector{CartesianIndex{3}}:
 CartesianIndex(1, 1, 1)
 CartesianIndex(2, 4, 1)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; pos = DoseGridMasked(axes, indices);</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>In this example, only positions at indices <code>[1, 1, 1]</code> and <code>[2, 4, 1]</code> are not masked and used in iteration:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; for i in eachindex(pos)
           @show i, pos[i]
       end</code><code class="nohighlight hljs ansi" style="display:block;">(i, pos[i]) = (1, [-10.0, -10.0, -10.0])
(i, pos[i]) = (2, [-5.0, 5.0, -10.0])</code></pre><p>When using a bounding object, the dose grid dimensions are set to encompass the whole bounding object, but points outside the bounding object are masked. For example, a masked dose grid bounded by a cylinder will produce the following:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; pos = DoseGridMasked(5., CylinderBounds(10., 10.));</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; getaxes(pos)</code><code class="nohighlight hljs ansi" style="display:block;">(-5.0:5.0:5.0, -5.0:5.0:5.0, -5.0:5.0:5.0)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; length(pos)</code><code class="nohighlight hljs ansi" style="display:block;">15</code></pre><p>While the axes still encompass the cylinder, the number of points (<code>length</code>) are less (15&lt;5^3).</p><p>Linear indexing is supported, and Cartesian indexing will work if the index is not masked. For example the following will work,</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; pos[2]</code><code class="nohighlight hljs ansi" style="display:block;">3-element StaticArraysCore.SVector{3, Float64} with indices SOneTo(3):
 -5.0
  0.0
 -5.0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; pos[1,1,1]</code><code class="nohighlight hljs ansi" style="display:block;">3-element StaticArraysCore.SVector{3, Float64} with indices SOneTo(3):
  0.0
 -5.0
 -5.0</code></pre><p>Suppling an index where the point is masked will throw a <code>BoundsError</code>,</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; pos[1,2,1]</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: BoundsError: attempt to access 15-element DoseGridMasked{Float64, StepRangeLen{Float64, Base.TwicePrecision{Float64}, Base.TwicePrecision{Float64}, Int64}, StepRangeLen{Float64, Base.TwicePrecision{Float64}, Base.TwicePrecision{Float64}, Int64}, StepRangeLen{Float64, Base.TwicePrecision{Float64}, Base.TwicePrecision{Float64}, Int64}} at index [1, 2, 1]</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../DoseVolume/">« Dose Volumes</a><a class="docs-footer-nextpage" href="../ExternalSurfaces/">External Surfaces »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Thursday 31 August 2023 08:43">Thursday 31 August 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
